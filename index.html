<html>
  <div>
    <div id="phase" style="background-color:#aaa; margin:auto; width:80%;">
      <h1 id="headline">
        Kalos Timers p2-1
      </h1>
      <button class="button1" onclick="startPhase(3)">
        <p>p2 Start</p>
      </button>
      <p>Systems:<b id="systemsOnline">--</b>
        <button class="button2" onclick="incSystems()">
          <p>+</p>
        </button>
        <button class="button2" onclick="decSystems()">
          <p>-</p>
        </button>
      </p>
      <p>
        HP: 
        <button class="button2" onclick="changePhase(4)">
          <p>0%-25%</p>
        </button>
        <button class="button2" onclick="changePhase(3)">
          <p>26%-50%</p>
        </button>
        <button class="button2" onclick="changePhase(2)">
          <p>51%-75%</p>
        </button>
        <button class="button2" onclick="changePhase(1)">
          <p>76%-100%</p>
        </button>
      </p>
      <p>
        Test: 
        <button class="button1" onclick="phaseTest()">
          <p>Start</p>
        </button>
        <button class="button1" onclick="failTest()">
          <p>Fail</p>
        </button>
        <p id="tester"></p>
      </p>
    </div>
  </div>
  <div class="item2" id="bombBox" style="background-color:#ccc;">
    <h2 id="bombTimer">--</h2>
    <button class="button1" onclick="bombTimer()">
      <p>Bombs</p>
    </button>
    <button class="button2" onclick="bombReset()">
      <p>Cancel</p>
    </button>
  </div>



  <div class="grid-container1">
    <div class="item1" id="breathBox" style="background-color:#ccc;">
      <h2 id="breathTimer">--</h2>
      <button class="button1" onclick="breathTimer()"> 
        <p>Laser</p>
      </button>
    </div>
    <div class="item1" id="diveBox" style="background-color:#ccc;">
      <h2 id="diveTimer">--</h2>
      <button class="button1" onclick="diveTimer()">
        <p>Dive</p>
      </button>
    </div>
    <div class="item1" id="fmaBox" style="background-color:#ccc;">
      <h2 id="fmaTimer">--</h2>
      <button class="button1" onclick="fmaMaxSystemsCheck(); fmaTimer(150); incSystems()">
        <p>FMA</p>
      </button>
      <button class="button2" onclick="fmaAdd10()">
        <p>10s bind</p>
      </button>
      <button class="button2" onclick="fmaAdd15()">
        <p>15s bind</p>
      </button>
    </div>
    <div class="item1" id="systemFailBox" style="background-color:#ccc;">
      <h2 id="systemFailTimer">--</h2>
      
      <button class="button1" onclick="systemCleanse()">
        <p>Cleanse</p>
      </button>
      <button class="button2" onclick="systemFailTimer(60)">
        <p>Reset System Activation</p>
      </button>
      <button class="button2" onclick="systemFailReset()">
        <p>Cancel</p>
      </button>
    </div>
  </div>
</html>

<style>
  h1 {text-align: center; font-size: 40;}
  h2 {text-align: center; font-size: 40;}
  h3 {text-align: center; font-size: 25;}
  div {text-align: center; padding: 10px;}
  p {text-align: center;}
  b {padding: 10px}
  .item1 {border: 3px solid transparent; display: block; align-items: center; justify-content: center; height: 152px;}
  .item2 {border: 3px solid transparent; margin: auto; width:20%; display: block; align-items: center; justify-content: center; height: 152px;}
  .grid-container1 {margin: auto; width:80%; display: grid; grid-gap: 10px; grid-template-columns: 1fr 1fr;}
  .button1 {
    background-color: #555555;
    border: none;
    color: white;
    padding: 1px 16px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
    border-radius: 3px;
  }
  .button2 {
    background-color: white;
    border: #555555;
    color: black;
    padding: 1px 16px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 11px;
    border-radius: 3px;
  }
</style>

<script>
  const warningBomb = 3;
  const warningBreath = 5;
  const warningDive = 5;
  const warningFMA = 20;
  const warningSystemFail = 20;
  const maxSystems = 4;
  const minSystems = 0;
  const maxPhase = 4;
  const minPhase = 1;
  const systemCooldown = 60;
  const bombCooldown = 10;
  const diveCooldown = 20;
  const fmaCooldown = 150;

  var phase;

  var bombCountdown;
  var breathCountdown;
  var diveCountdown;
  var fmaCountdown;
  var systemFailCountdown;

  var bombSec;
  var breathSec;
  var diveSec;
  var fmaSec = fmaCooldown;
  var systemFailSec = systemCooldown;

  var numSystemsOnline = 0;
  var phaseFMASec = 0;
  var phaseSystemSec = 0;
  var phaseCountdown;
  var phaseSec = 0;
  






  function changePhase(num) {
    phase = num;
    document.getElementById('headline').innerHTML="Kalos Timers p2-"+phase;
  }

  function startPhase() {
    phase = 1;
    bombTimer();
    fmaTimer(fmaCooldown);
    systemFailTimer(systemCooldown);
    numSystemsOnline = 0;
    document.getElementById('systemsOnline').innerHTML = numSystemsOnline;
  }

  function incSystems () {
    if (numSystemsOnline != maxSystems) {
      numSystemsOnline += 1;
    }
    document.getElementById('systemsOnline').innerHTML = numSystemsOnline;
    checkWarningNumSystems();
  }
  
  function decSystems () {
    if (numSystemsOnline >= 1) {
      numSystemsOnline -= 1;
    }
    document.getElementById('systemsOnline').innerHTML = numSystemsOnline;
    checkWarningNumSystems();
  }

  function checkWarningNumSystems () {
    if (numSystemsOnline == maxSystems) {
      document.getElementById("systemsOnline").style.color = 'red';
      document.getElementById("systemFailTimer").style.color = 'red';
    } else {
      document.getElementById("systemsOnline").style.color = 'black';
    }
  }

  function phaseTest(){
    phaseSec = 50;
    clearInterval(phaseCountdown);
    phaseCountdown = setInterval(function(){
        phaseSec--;
        if (phaseSec <= 0) {
          clearInterval(phaseCountdown);
          phaseFMASec = 0;
          phaseSystemSec = 0;
        }
      }, 1000);
      
    phaseFMASec = fmaSec;
    clearInterval(fmaCountdown);
    fmaSec += 50;
    fmaTimer(fmaSec);
    checkWarningFMA();

    if (numSystemsOnline != maxSystems) {
      phaseSystemSec = systemFailSec;
      clearInterval(systemFailCountdown);
      systemFailSec += 50;
      systemFailTimer(systemFailSec);
      checkWarningSystemFail();
    }

    if (phase < maxPhase){
      changePhase(phase+1);
    }
  }

  function failTest() {
    if (phaseSec > 0) {
      clearInterval(fmaCountdown);
      fmaTimer(phaseFMASec);
      checkWarningFMA();

      if (numSystemsOnline != maxSystems) {
        clearInterval(systemFailCountdown);
        systemFailTimer(phaseSystemSec);
        checkWarningSystemFail();
      }

      if (phase > minPhase){
        changePhase(phase-1);
      }
      clearInterval(phaseCountdown);
      phaseSec = 0;
    }
  }












  function checkWarningBomb() {
    if (bombSec <= warningBomb) {
      document.getElementById("bombTimer").style.color = 'red';
    }
    else {
      document.getElementById("bombTimer").style.color = 'black';
    }
  }
  function bombTimer(){
    bombSec = bombCooldown;
    document.getElementById('bombTimer').innerHTML = bombSec;
    checkWarningBomb();
    clearInterval(bombCountdown);
    bombCountdown = setInterval(function(){
      bombSec--;
      document.getElementById('bombTimer').innerHTML = bombSec;
      checkWarningBomb();
      if (bombSec <= 0) {
        bombSec = bombCooldown;
      }
    }, 1000);
  }
  function bombReset(){
    bombSec = bombCooldown;
    document.getElementById('bombTimer').innerHTML = "--";
    checkWarningBomb();
    clearInterval(bombCountdown);
  }










  function checkWarningBreath() {
    if (breathSec <= warningBreath) {
      document.getElementById("breathTimer").style.color = 'red';
      document.getElementById("breathBox").style.border = '3px solid red';
    }
    else {
      document.getElementById("breathTimer").style.color = 'black';
      document.getElementById("breathBox").style.border = '3px solid transparent';
    }
  }
  function breathTimer(){
    if (phase == 1) {
      breathSec = 60;
    }
    if (phase == 2) {
      breathSec = 45;
    }
    if (phase >= 3) {
      breathSec = 30;
    }
    document.getElementById('breathTimer').innerHTML = breathSec;
    checkWarningBreath();
    clearInterval(breathCountdown);
    breathCountdown = setInterval(function(){
      breathSec--;
      document.getElementById('breathTimer').innerHTML = breathSec;
      checkWarningBreath();
      if (breathSec <= 0) {
        clearInterval(breathCountdown);
      }
    }, 1000);
  }


  








  function checkWarningDive() {
    if (diveSec <= warningDive) {
      document.getElementById("diveTimer").style.color = 'red';
      document.getElementById("diveBox").style.border = '3px solid red';
    }
    else {
      document.getElementById("diveTimer").style.color = 'black';
      document.getElementById("diveBox").style.border = '3px solid transparent';
    }
  }
    function diveTimer() {
      diveSec = diveCooldown;
      document.getElementById('diveTimer').innerHTML = diveSec;
      checkWarningDive();
      clearInterval(diveCountdown);
      diveCountdown = setInterval(function(){
        diveSec--;
        document.getElementById('diveTimer').innerHTML = diveSec;
        checkWarningDive();
        if (diveSec <= 0) {
          clearInterval(diveCountdown);
        }
      }, 1000);
    }










  
  function checkWarningFMA() {
    if (fmaSec <= warningFMA) {
      document.getElementById("fmaTimer").style.color = 'red';
      document.getElementById("fmaBox").style.border = '3px solid red';
      document.getElementById("fmaBox").style.background = '#F9C3C3';
    }
    else {
      document.getElementById("fmaTimer").style.color = 'black';
      document.getElementById("fmaBox").style.border = '3px solid transparent';
      document.getElementById("fmaBox").style.background = '#ccc';
    }
  }
  function fmaTimer(sec) {
    fmaSec = sec;
    document.getElementById('fmaTimer').innerHTML = fmaSec;
    checkWarningFMA();
    clearInterval(fmaCountdown);
    fmaCountdown = setInterval(function(){
      fmaSec--;
      document.getElementById('fmaTimer').innerHTML = fmaSec;
      checkWarningFMA();
      if (fmaSec <= 0) {
        clearInterval(fmaCountdown);
      }
    }, 1000);
  }
  function fmaAdd10(){
    clearInterval(fmaCountdown);
    fmaSec += 10;
    fmaTimer(fmaSec);
    checkWarningFMA();
  }
  function fmaAdd15(){
    clearInterval(fmaCountdown);
    fmaSec += 15;
    fmaTimer(fmaSec);
    checkWarningFMA();
  }
  function fmaMaxSystemsCheck() {
    if (numSystemsOnline == maxSystems-1) {
        systemFailTimer(systemCooldown);
    }
  }


  



  function checkWarningSystemFail() {
    
    if (numSystemsOnline == maxSystems) {
      document.getElementById("systemFailTimer").style.color = 'red';
      if (systemFailSec <= warningSystemFail) {
        document.getElementById("systemFailBox").style.border = '3px solid red';
        document.getElementById("systemFailBox").style.background = '#F9C3C3';
      }
    }
    else {
      document.getElementById("systemFailTimer").style.color = 'black';
      document.getElementById("systemFailBox").style.border = '3px solid transparent';
      document.getElementById("systemFailBox").style.background = '#ccc';
    }
  }

  function systemFailTimer(sec){
    systemFailSec = sec;
    checkWarningSystemFail();
    document.getElementById('systemFailTimer').innerHTML = systemFailSec;
    
    clearInterval(systemFailCountdown);
    systemFailCountdown = setInterval(function(){
      systemFailSec--;
      document.getElementById('systemFailTimer').innerHTML = systemFailSec;
      checkWarningSystemFail();
      if (systemFailSec <= 0) {
        incSystems();
        clearInterval(systemFailCountdown);
        systemFailTimer(systemCooldown);
      }
    }, 1000);
  }
  function systemFailReset(){
    systemFailSec = systemCooldown;
    document.getElementById('systemFailTimer').innerHTML = "--";
    checkWarningSystemFail();
    clearInterval(systemFailCountdown);
  }
  function systemCleanse() {
    if (numSystemsOnline == maxSystems) {
      systemFailTimer(systemCooldown + phaseSec);
      phaseSystemSec = systemCooldown;
    }
    decSystems();
    checkWarningSystemFail();
    document.getElementById('systemsOnline').innerHTML = numSystemsOnline;
  }

  </script>
